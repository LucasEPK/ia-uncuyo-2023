---
title: "TP7 notebook"
output: html_notebook
---

1.  Bajar el archivo arbolado-mendoza-dataset.csv, el mismo se encuentra en formato CSV (comma separated values).

<!-- -->

a.  Seleccionar de manera uniformemente aleatoria el 20% del conjunto de datos y crear un nuevo archivo con el nombre de arbolado-mendoza-dataset-validation.csv y el 80% restante con el nombre de arbolado-mendoza-dataset-train.csv

```{r}
library(readr)
library(tidyverse)
library(caret)

arboladoDS <- read_csv("../data/arbolado-mza-dataset.csv")
arboladoRows <- nrow(arboladoDS)
# Here we shuffle the dataset's rows randomly
shuffledDS <- arboladoDS[sample(1:arboladoRows),]

# Here we calculate how many rows is 20% of the total rows, and also the remaining 80%
N20Percent <- round(arboladoRows*0.20)
Nremaining <- arboladoRows-N20Percent
# Here we split the shuffled dataset in a half, validationDS takes the first 20% of rows while trainDS takes the remaining 80% of rows
validationDS <- slice_head(shuffledDS, n = N20Percent)
trainDS <- slice_tail(shuffledDS, n = Nremaining)

# Writes to memory the resulting train and validation datasets
write.csv(validationDS, "../data/arbolado-mza-dataset-validation.csv", row.names=FALSE)
write.csv(trainDS, "../data/arbolado-mza-dataset-train.csv", row.names=FALSE)
```

2.  A partir del archivo arbolado-mendoza-dataset-train.csv responder las siguientes preguntas:

<!-- -->

a.  Cual es la distribución de las clase inclinacion_peligrosa?
b.  ¿Se puede considerar alguna sección más peligrosa que otra?
c.  ¿Se puede considerar alguna especie más peligrosa que otra?

IMPORTANTE: para responder cada una de estas preguntas se deberá generar una visualización/gráfico que justifique la respuesta.

```{r}
library(readr)
library(tidyverse)
library(caret)
library(ggplot2)

arboladoTrainDS <- read_csv("../data/arbolado-mza-dataset-train.csv")

inclinacionPeligrosaColumn <- select(arboladoTrainDS, inclinacion_peligrosa)
distribucionPeligrosa <- table(inclinacionPeligrosaColumn)
distribucionPeligrosa
barplot(distribucionPeligrosa)


# Here we group by species and calculate the probability of picking randomly a dangerously inclined tree by specie
especiesPeligrosas <- arboladoTrainDS %>% group_by(especie) %>%
  summarise(
    porcentaje_inclinacion_peligrosa = sum(inclinacion_peligrosa)/length(inclinacion_peligrosa)
  )

ggplot(especiesPeligrosas, aes(x=especie, y=porcentaje_inclinacion_peligrosa)) + 
  geom_bar(stat = "identity")+
  coord_flip()

# Here we group by sections and calculate the probability of picking randomly a dangerously inclined tree by sections
seccionesPeligrosas <- arboladoTrainDS %>% group_by(nombre_seccion) %>%
  summarise(
    porcentaje_inclinacion_peligrosa = sum(inclinacion_peligrosa)/length(inclinacion_peligrosa)
  )

ggplot(seccionesPeligrosas, aes(x=nombre_seccion, y=porcentaje_inclinacion_peligrosa)) + 
  geom_bar(stat = "identity")+
  coord_flip()
```

3.  A partir del archivo arbolado-mendoza-dataset-train.csv:

<!-- -->

b.  Generar un histograma de frecuencia para la variable circ_tronco_cm. Probar con diferentes números de bins.\
c.  Repetir el punto b) pero separando por la clase de la variable inclinación_peligrosa?\
d.  Crear una nueva variable categórica de nombre circ_tronco_cm_cat a partir circ_tronco_cm, en donde puedan asignarse solo 4 posibles valores [ muy alto, alto, medio, bajo ]. Utilizar la información del punto b. para seleccionar los puntos de corte para cada categoría. Guardar el nuevo dataframe bajo el nombre de arbolado-mendoza-dataset-circ_tronco_cm-train.csv

Los criterios de corte son: Si es menor que 90, bajo si es mayor o igual que 90 y menor que 170, medio si es mayor o igual que 170 y menor que 240, alto si es mayor o igual que 240, muy alto

```{r}
library(readr)
library(tidyverse)
library(caret)

arboladoTrainDS <- read_csv("../data/arbolado-mza-dataset-train.csv")
# Makes different histograms with different bins values
hist(arboladoTrainDS$circ_tronco_cm, main = "Histograma de circ_tronco_cm", xlab = "Circunferencia tronco en cm", ylab = "Frecuencia", col = 4)
hist(arboladoTrainDS$circ_tronco_cm, breaks = 50, main = "Histograma de circ_tronco_cm con 50 bins", xlab = "Circunferencia tronco en cm", ylab = "Frecuencia", col = 4)
hist(arboladoTrainDS$circ_tronco_cm, breaks = 100, main = "Histograma de circ_tronco_cm con 100 bins", xlab = "Circunferencia tronco en cm", ylab = "Frecuencia", col = 4)
hist(arboladoTrainDS$circ_tronco_cm, breaks = 200, main = "Histograma de circ_tronco_cm con 200 bins", xlab = "Circunferencia tronco en cm", ylab = "Frecuencia", col = 4)

# Select circ_tronco_cm where inclinacion_peligrosa is equal to 0
circTroncoSinPeligro <- subset(arboladoTrainDS$circ_tronco_cm, arboladoTrainDS$inclinacion_peligrosa == 0)
# Select circ_tronco_cm where inclinacion_peligrosa is equal to 1
circTroncoPeligrosa <- subset(arboladoTrainDS$circ_tronco_cm, arboladoTrainDS$inclinacion_peligrosa == 1)

hist(circTroncoSinPeligro, main = "Histograma de circ_tronco_cm SIN inclinación peligrosa", xlab = "Circunferencia tronco en cm", ylab = "Frecuencia", breaks = 20, col = 3)
hist(circTroncoPeligrosa, main = "Histograma de circ_tronco_cm CON inclinación peligrosa", xlab = "Circunferencia tronco en cm", ylab = "Frecuencia", col = 2)

circTroncoDS <- arboladoTrainDS %>% 
  mutate(circ_tronco_cm_cat = ifelse(circ_tronco_cm < 90, "bajo",
                                ifelse(circ_tronco_cm < 170, "medio", 
                                       ifelse(circ_tronco_cm < 240, "alto", "muy alto")
                                       )
                                )
         )

write.csv(circTroncoDS, "../data/arbolado-mza-dataset-circ_tronco_cm-train.csv", row.names=FALSE)
```
